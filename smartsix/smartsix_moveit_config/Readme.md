# smartsix_moveit_config

## Introduction and useful notes

The package contains the configuration and startup files of the Comau Smart-Six robot. The package was generated by MoveIt! Setup Assistant, using xacro files from the `comau_description` package.

Some manual changes to `ros_controller.yaml` have been made to load the robot in Gazebo and configure controllers:

* joint position controllers (`position_controllers/JointPositionController`) have been added to perform a point-to-point trajectory; to interact with these controllers, you can use the `rqt_gui` to publish the desired joint positions;

* a joint trajectory controller (`position_controllers/JointTrajectoryController`) has been added to perform a multi-point trajectory; you can use the `smartsix_controller` to define and publish the trajectory.

* the `smartsix` namespace has been added in order to instantiate the `gazebo_ros_control` plugin.

Moreover, new launch and configuration files have been added to use interaction controllers with both the real and simulated robot. Please refer to [Interaction controllers demos](#interaction-controllers-demos) for more info.

## Getting Started

### Prerequisites

The following prerequisites are necessary to get started (other configurations may work but were not validated):

* Ubuntu 18.04
* ROS Melodic
* MoveIt!

### Build and launch the demos

* Create a new catkin workspace folder (or use an existing one):

```bash
mkdir -p ~/catkin_ws/src
```

* To configure and build the workspace run

```bash
cd ~/catkin_ws
catkin config --extend /opt/ros/melodic --cmake-args -DCMAKE_BUILD_TYPE=Release
catkin build smartsix_moveit_config
```

* Source the setup file to configure the environment variables

```bash
source ~/catkin_ws/devel/setup.bash
```

* Add the full-path instruction above at the end of the ```.bashrc``` file so as not to configure the environment variables manually in each shell, e.g.

```bash
source /home/<username>/catkin_ws/devel/setup.bash
```

* Launch the nodes to load the Smart-Six model into Rviz and Gazebo

```bash
roslaunch smartsix_moveit_config demo.launch
roslaunch smartsix_moveit_config demo_gazebo.launch
```

## Interaction controllers demos

In order to use the admittance controller with the simulated Comau Smart-Six, it is necessary to run specific launch files in a specific order. For instance:

``` bash
source devel/setup.bash
roslaunch smartsix_moveit_config demo_gazebo_interaction_controllers.launch 
roslaunch smartsix_moveit_config admittance_controller_smartsix_gazebo_ft_sensor.launch
roslaunch follow_workspace_trajectory_action_client follow_workspace_trajectory_action_client.launch filename:=smartsix_gazebo_180s_0N_const.traj
```

Similarly for the direct force controller:

``` bash
source devel/setup.bash
roslaunch smartsix_moveit_config demo_gazebo_interaction_controllers.launch world:=smartsix_world_with_plane.world
roslaunch smartsix_moveit_config direct_force_controller_smartsix_gazebo_ft_sensor.launch
roslaunch follow_workspace_trajectory_action_client follow_workspace_trajectory_action_client.launch filename:=smartsix_gazebo_180s_50N_ramp.traj
```

## Known issues

* The MoveIt! Setup Assistant generates incorrect configuration for joint position controllers: the original `ros_controller.yaml` file contains PIDs that are unexpected, given the nature of the implemented controller (forward position controller).

* When the robot model is loaded in Gazebo, the following errors show up in the console:

```
    [ERROR] [1589711315.200973423, 0.287000000]: No p gain specified for pid. Namespace: /smartsix/gazebo_ros_control/pid_gains/joint1.
    ...
    [ERROR] [1589711315.205083117, 0.287000000]: No p gain specified for pid. Namespace: /smartsix/gazebo_ros_control/pid_gains/joint2.
    ...
    [ERROR] [1589711315.208417117, 0.287000000]: No p gain specified for pid. Namespace: /smartsix/gazebo_ros_control/pid_gains/joint3.
    ...
    [ERROR] [1589711315.211466682, 0.287000000]: No p gain specified for pid. Namespace: /smartsix/gazebo_ros_control/pid_gains/joint4.
    ...
    [ERROR] [1589711315.216595076, 0.287000000]: No p gain specified for pid. Namespace: /smartsix/gazebo_ros_control/pid_gains/joint5.
    ...
    [ERROR] [1589711315.244787451, 0.287000000]: No p gain specified for pid. Namespace: /smartsix/gazebo_ros_control/pid_gains/joint6.
    ...
```

This occurs because we do not specify the values of the PID gains, given the nature of our controllers, which are direct position controllers.

* When the robot model is loaded in Rviz, the following errors show up in the console, but they can be ignored:

```
    [ERROR] [1591639981.236759290]: No sensor plugin specified for octomap updater 0; ignoring.
    ...
    [ERROR] [1591639981.318876022]: Could not find the planner configuration 'None' on the param server.
    ...
```
